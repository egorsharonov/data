<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
  xmlns:camunda="http://camunda.org/schema/1.0/bpmn"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.37.0">
  <bpmn:process id="portin-process" name="MNP PortIn Process" isExecutable="true" camunda:historyTimeToLive="3">
    <bpmn:startEvent id="StartEvent_1" name="Start Process">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="orderId" label="Order ID" type="string" />
          <camunda:formField id="eventType" label="Event Type" type="string" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:outgoing>Flow_0vbcvzq</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_0vbcvzq" sourceRef="StartEvent_1" targetRef="Activity_FilterMessage" />
    <bpmn:businessRuleTask id="Activity_FilterMessage" name="Filter Message" camunda:resultVariable="messageEnabled" camunda:decisionRef="filtering_service" camunda:mapDecisionResult="singleEntry">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="eventType">${eventType}</camunda:inputParameter>
          <camunda:outputParameter name="messageEnabled">${messageEnabled}</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0vbcvzq</bpmn:incoming>
      <bpmn:outgoing>Flow_0ilec7o</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:exclusiveGateway id="Gateway_1jk8u9f" name="Message Enabled">
      <bpmn:incoming>Flow_0ilec7o</bpmn:incoming>
      <bpmn:outgoing>Flow_0ym7a6n</bpmn:outgoing>
      <bpmn:outgoing>Flow_0qx7wp8</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0ym7a6n" name="Yes" sourceRef="Gateway_1jk8u9f" targetRef="Activity_MessageEnrichmentDecision">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${messageEnabled == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0qx7wp8" name="No" sourceRef="Gateway_1jk8u9f" targetRef="Event_ProcessEnd">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${messageEnabled == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:businessRuleTask id="Activity_MessageEnrichmentDecision" name="Message enrich decision" camunda:resultVariable="enrichWithExternalData" camunda:decisionRef="message_enrich_decision" camunda:mapDecisionResult="singleEntry">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="eventType">${eventType}</camunda:inputParameter>
          <camunda:outputParameter name="enrichWithExternalData">${enrichWithExternalData}</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0ym7a6n</bpmn:incoming>
      <bpmn:outgoing>Flow_0uzzygw</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:sequenceFlow id="Flow_0uzzygw" sourceRef="Activity_MessageEnrichmentDecision" targetRef="Gateway_0shkwe5" />
    <bpmn:exclusiveGateway id="Gateway_0shkwe5" name="Enriched with external data">
      <bpmn:incoming>Flow_0uzzygw</bpmn:incoming>
      <bpmn:outgoing>Flow_1vfk1ci</bpmn:outgoing>
      <bpmn:outgoing>Flow_0n7kzkk</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1vfk1ci" name="No" sourceRef="Gateway_0shkwe5" targetRef="Activity_DataEnrichment">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${enrichWithExternalData == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:serviceTask id="Activity_DataEnrichment" name="Enrichment [Data Service]" camunda:type="external" camunda:topic="portin-data-enrich">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="orderId">${orderId}</camunda:inputParameter>
          <camunda:inputParameter name="eventType">${eventType}</camunda:inputParameter>
        </camunda:inputOutput>
        <camunda:failedJobRetryTimeCycle>R3/PT30S</camunda:failedJobRetryTimeCycle>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1vfk1ci</bpmn:incoming>
      <bpmn:incoming>Flow_1s0oek1</bpmn:incoming>
      <bpmn:outgoing>Flow_1teddq1</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1teddq1" sourceRef="Activity_DataEnrichment" targetRef="Activity_KafkaRestCall" />
    <bpmn:serviceTask id="Activity_ExternalDataEnrichment" name="Enrichment [Parameters Service]" camunda:type="external" camunda:topic="portin-ext-data-enrich">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="orderId">${orderId}</camunda:inputParameter>
          <camunda:inputParameter name="eventType">${eventType}</camunda:inputParameter>
        </camunda:inputOutput>
        <camunda:failedJobRetryTimeCycle>R3/PT30S</camunda:failedJobRetryTimeCycle>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0n7kzkk</bpmn:incoming>
      <bpmn:outgoing>Flow_1s0oek1</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0n7kzkk" name="Yes" sourceRef="Gateway_0shkwe5" targetRef="Activity_ExternalDataEnrichment">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${enrichWithExternalData == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1s0oek1" sourceRef="Activity_ExternalDataEnrichment" targetRef="Activity_DataEnrichment" />
    <bpmn:serviceTask id="Activity_KafkaRestCall" name="Send to Kafka" camunda:type="external" camunda:topic="kafka-rest-call">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="eventType">${eventType}</camunda:inputParameter>
          <camunda:inputParameter name="rtmMessageKey">${rtmMessageKey}</camunda:inputParameter>
          <camunda:inputParameter name="rtmMessagePayload">${rtmMessagePayload}</camunda:inputParameter>
        </camunda:inputOutput>
        <camunda:failedJobRetryTimeCycle>R0</camunda:failedJobRetryTimeCycle>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1teddq1</bpmn:incoming>
      <bpmn:outgoing>Flow_1rj8ciq</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_LogSuccess" name="Log Success" camunda:type="external" camunda:topic="log-success">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="orderId">${orderId}</camunda:inputParameter>
          <camunda:inputParameter name="eventType">${eventType}</camunda:inputParameter>
          <camunda:inputParameter name="message">Successfully processed MNP request</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1rj8ciq</bpmn:incoming>
      <bpmn:outgoing>Flow_0d7x9zt</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0d7x9zt" sourceRef="Activity_LogSuccess" targetRef="Event_ProcessEnd" />
    <bpmn:endEvent id="Event_ProcessEnd" name="Process End">
      <bpmn:incoming>Flow_0qx7wp8</bpmn:incoming>
      <bpmn:incoming>Flow_0d7x9zt</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_0ilec7o" sourceRef="Activity_FilterMessage" targetRef="Gateway_1jk8u9f" />
    <bpmn:sequenceFlow id="Flow_1rj8ciq" sourceRef="Activity_KafkaRestCall" targetRef="Activity_LogSuccess" />
  </bpmn:process>
  <bpmn:error id="Error_1" name="Process_Aborted" errorCode="PROCESS_ABORTED" />
  <bpmn:error id="Error_KafkaFailed" name="Kafka_Failed" errorCode="KAFKA_FAILED" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="portin-process">
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="172" y="142" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="156" y="118" width="67" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_FilterMessage_di" bpmnElement="Activity_FilterMessage">
        <dc:Bounds x="320" y="120" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1jk8u9f_di" bpmnElement="Gateway_1jk8u9f" isMarkerVisible="true">
        <dc:Bounds x="495" y="135" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="476" y="105" width="89" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_MessageEnrichmentDecision_di" bpmnElement="Activity_MessageEnrichmentDecision">
        <dc:Bounds x="600" y="120" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0shkwe5_di" bpmnElement="Gateway_0shkwe5" isMarkerVisible="true">
        <dc:Bounds x="745" y="135" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="736" y="98" width="67" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_DataEnrichment_di" bpmnElement="Activity_DataEnrichment">
        <dc:Bounds x="1060" y="120" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_ExternalDataEnrichment_di" bpmnElement="Activity_ExternalDataEnrichment">
        <dc:Bounds x="870" y="240" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1ixcpxr_di" bpmnElement="Activity_KafkaRestCall">
        <dc:Bounds x="1260" y="120" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_LogSuccess_di" bpmnElement="Activity_LogSuccess">
        <dc:Bounds x="1470" y="120" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_ProcessEnd_di" bpmnElement="Event_ProcessEnd">
        <dc:Bounds x="1672" y="142" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1658" y="123" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0vbcvzq_di" bpmnElement="Flow_0vbcvzq">
        <di:waypoint x="208" y="160" />
        <di:waypoint x="320" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ym7a6n_di" bpmnElement="Flow_0ym7a6n">
        <di:waypoint x="545" y="160" />
        <di:waypoint x="600" y="160" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="549" y="142" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0qx7wp8_di" bpmnElement="Flow_0qx7wp8">
        <di:waypoint x="520" y="185" />
        <di:waypoint x="520" y="500" />
        <di:waypoint x="1690" y="500" />
        <di:waypoint x="1690" y="178" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="492" y="203" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0uzzygw_di" bpmnElement="Flow_0uzzygw">
        <di:waypoint x="700" y="160" />
        <di:waypoint x="745" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1vfk1ci_di" bpmnElement="Flow_1vfk1ci">
        <di:waypoint x="795" y="160" />
        <di:waypoint x="1060" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1teddq1_di" bpmnElement="Flow_1teddq1">
        <di:waypoint x="1160" y="160" />
        <di:waypoint x="1260" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0n7kzkk_di" bpmnElement="Flow_0n7kzkk">
        <di:waypoint x="770" y="185" />
        <di:waypoint x="770" y="280" />
        <di:waypoint x="870" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1s0oek1_di" bpmnElement="Flow_1s0oek1">
        <di:waypoint x="970" y="280" />
        <di:waypoint x="1015" y="280" />
        <di:waypoint x="1015" y="160" />
        <di:waypoint x="1060" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0d7x9zt_di" bpmnElement="Flow_0d7x9zt">
        <di:waypoint x="1570" y="160" />
        <di:waypoint x="1672" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ilec7o_di" bpmnElement="Flow_0ilec7o">
        <di:waypoint x="420" y="160" />
        <di:waypoint x="495" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1rj8ciq_di" bpmnElement="Flow_1rj8ciq">
        <di:waypoint x="1360" y="160" />
        <di:waypoint x="1470" y="160" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>